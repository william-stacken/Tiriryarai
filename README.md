# Tiriryarai
An HTTPS man-in-the-middle proxy framework written in C#.

![logo](Tiriryarai/favicon.ico)

## Table of Contents
 - [1. Features](#1-features)
 - [2. Files](#2-files)
 - [3. Web Interface](#3-web-interface)
 - [4. How To Build](#4-how-to-build)
   - [4.1. Linux](#41-linux)
 - [5. Adding Plugins](#5-adding-plugins)
 - [6. How To Use](#6-how-to-use)
 - [7. License](#7-license)

## 1. Features
- Automated certificate creation for each host.
- Customized plugins for automated HTTP request and response modification and interception.
- OCSP query support (No OCSP stapling).
- Certificate Revocation List (CRL) support.
- Logging of incomming HTTP requests and responses using different verbosity levels.
- Web interfaces with HTTP basic authentication support.
  - Customized web interfaces for remote plugin configuration.
  - Web interface to view and delete logs remotely.


## 2. Files
The program creates the following folders and files:
 - **logs**: Folder that contains one log file for each host, named `<hostname>.log`, containing
             each request sent and response received from that host.
 - **-RootCA-.pfx**: PKCS12 file containing the Root CA certificate that will be used to sign
                     certificates generated by Tiriryarai. The Root CA certificate needs to be
                     installed in your client, refer to [5. How To Use](#5-how-to-use) for details.
                     The password to this file is `secret`.
 - **-OcspCA-.pfx**: PKCS12 file containing the OCSP CA certificate that will be used to sign
                     OCSP responses generated by Tiriryarai. The password to this file is `secret`.
 - **-MitM-.pfx**: PKCS12 file containing the certificate that will be used to authenticate the
                   Man-in-the-middle plugins. The password to this file is `secret`.

By default, they can be found in the application data folder, which is `$HOME/.config/Tiriryarai`
on Unix systems.

## 3. Web Interface

## 4. How To Build
### 4.1 Linux
Install **Mono** from [here](https://www.mono-project.com/download/stable/#download-lin) and run `msbuild Tiriryarai.sln`

## 5. Adding Plugins
 - Add a new .NET Console application project to the solution. Select .NET Framework 4.8 as the target framework.
 - Add a reference to the `Tiriryarai` project, `System.Web`, `System.Runtime.Config`, `Mono.Security`, and `Mono.Options`.
 - Create a new class that implements the [`IManInTheMiddle`](Tiriryarai/Server/IManInTheMiddle.cs) interface. See
   the link for documentation of which methods must be implemented.

[`TiriryaraiMitm`](TiriryaraiMitm) contains a dummy example plugin that can be used for reference.

## 6. How To Use
Tiriryarai accepts a number of command line arguments which can configure it. For a list of those arguments, use
the `-h` flag.

The first time Tiriryarai starts up it needs to generate the `.pfx` files, which takes a few seconds. To
use the proxy, you need to install its Root CA certificate. After Tiriryarai has started correctly, open
`http://<your-hostname-or-ip-address>:<your-port>` and click the download link. From there, install it in
your client. You also need to configure your client to use the proxy.

## 7. License
Copyright (C) 2021 William Stacken√§s <w.stackenas@gmail.com>

This README file documents the use of Tiriryarai.

Tiriryarai is free software: you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.

Tiriryarai is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public License
along with this program.  If not, see <http://www.gnu.org/licenses/>.
